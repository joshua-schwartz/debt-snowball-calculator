<!doctype html>
<html lang="en">

<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">

    <title>Debt Snowball Calculator</title>

    <style>
        .debts-list input {
            opacity: 0.6;
        }

        .debts-list li:last-of-type input,
        .debts-list input:focus,
        .debts-list input:active {
            opacity: 1;
        }
    </style>
</head>

<body>
    <header>
        <h1>Debt Snowball Calculator</h1>
    </header>
    <main class="container mt-4">
        <div class="row">
            <div class="col-12">
                <p>Use this calculator to find out how long it will take you to pay off your debt and how much interest
                    you'll pay if you prioritize debts by balance or by interest rate. Try adjusting your monthly debt
                    budget amount to see how much time and money you could save if you can make extra payments!</p>
                <p>We take your debts, order them by balance and by interest rate, then simulate paying your bills each
                    month by prioritizing one debt at a time. We set aside enough to pay the accrued interest for each
                    debt that month, then apply whatever is left over to the prioritized debt. As debts get paid off,
                    there is more money each month to go toward the next debt, and it gains momentum as each debt is
                    eliminated!</p>
            </div>
        </div>
        <div class="row">
            <div class="col-12">
                <div class="card">
                    <h5 class="card-header">List the debts you're paying off</h5>
                    <div class="card-body">
                        <div class="row debts-header mb-1">
                            <b class="col-3">Name</b>
                            <b class="col-3">Current Balance</b>
                            <b class="col-3">Interest Rate</b>
                            <b class="col-3">Min. Monthly Payment</b>
                        </div>
                        <ul class="row debts-list" style="padding-inline-start:0;">
                            <li class="input-group input-group-sm pl-2 pr-2 mt-1">
                                <input type="text" class="col-3 mr-1 form-control" aria-label="" aria-describedby="" data-debt-name>
                                <input type="number" class="col-3 mr-1 form-control" aria-label="" aria-describedby="" data-current-balance>
                                <input type="number" class="col-3 mr-1 form-control" aria-label="" aria-describedby="" data-interest-rate>
                                <input type="number" class="col-3 form-control" aria-label="" aria-describedby="" data-min-payment>
                            </li>
                        </ul>
                        <div class="clearfix">
                            <button class="btn btn-primary mt-1 float-right" onclick="addDebtItem()">Add Debt</button>
                        </div>
                    </div>
                </div>
                <div class="card mt-3">
                    <h5 class="card-header">How much money can you put toward these debts each month?</h5>
                    <div class="card-body">
                        <div class="set-budget-amount">
                            <div class="input-group input-group-sm">
                                <div class="input-group-prepend">
                                    <span class="input-group-text" id="inputGroup-sizing-sm">$</span>
                                </div>
                                <input type="number" class="form-control" aria-label="" aria-describedby="" data-debt-budget>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="clearfix">
                    <button class="btn btn-success mt-3 float-right" onclick="runSnowball()">Snowball!</button>
                </div>
            </div>
        </div>
        <div class="row mt-3 mb-4" style="display: none;" data-results-card>
            <div class="col-12">
                <div class="card">
                    <h5 class="card-header">Results</h5>
                    <div class="card-body">
                        <p>If you pay off your debts from smallest balance to largest:</p>
                        <ul class="mb-4">
                            <li>It will take <span data-balance-years></span> years and <span data-balance-months></span> months</li>
                            <li>$<span data-balance-cost></span> paid in interest</li>
                        </ul>
                        <p>If you pay off your debts from highest interest to lowest:</p>
                        <ul>
                            <li>It will take <span data-interest-years></span> years and <span data-interest-months></span> months</li>
                            <li>$<span data-interest-cost></span> paid in interest</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <script src="https://code.jquery.com/jquery-3.4.1.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>

    <script type="text/javascript">
        let debts = [];

        function addDebtItem() {
            let $newDebt = $(".debts-list li").first().clone().hide();
            $newDebt.find("input").each(function () {
                $(this).val("");
            });
            $newDebt.appendTo(".debts-list").fadeIn();
        }

        function getDebtsByBalance() {
            let debtsSortedByBalance = debts.map(i => ({
                ...i
            }));

            debtsSortedByBalance.reverse(debtsSortedByBalance.sort((a, b) => a.balance - b.balance));

            return debtsSortedByBalance;
        }

        function getDebtsByInterestRate() {
            let debtsSortedByInterestRate = debts.map(i => ({
                ...i
            }));

            debtsSortedByInterestRate.sort((a, b) => a.interestRate - b.interestRate);

            return debtsSortedByInterestRate;
        }

        // function getRemainingTotalBalance(debtList) {
        //     let totalBalance = 0;

        //     for (i = 0; i < debtList.length; i++) {
        //         let debtItem = debtList[i];
        //         totalBalance += debtItem.balance;
        //     }

        //     return totalBalance;
        // }

        function getTotalMonthlyInterest(debtList) {
            let monthlyInterest = 0;

            for (i = 0; i < debtList.length; i++) {
                let debtItem = debtList[i];
                monthlyInterest += ((debtItem.balance * debtItem.interestRate) / 12);
            }

            return monthlyInterest;
        }

        function getTotalMonthlyPrinciple(debtList) {
            let monthlyInterest = 0;

            for (i = 0; i < debtList.length; i++) {
                let debtItem = debtList[i];
                monthlyInterest += ((debtItem.balance * debtItem.interestRate) / 12);
            }

            return monthlyInterest;
        }

        function makeMinimumPayments(debtList) {
            for (i = 0; i < debtList.length; i++) {
                let debtItem = debtList[i];
                let monthlyInterest = ((debtItem.balance * debtItem.interestRate) / 12);
                let monthlyPrinciple = ((debtItem.balance * debtItem.principleRate) / 12);
                let monthlyMinimumPayment = monthlyPrinciple + monthlyInterest;

                debtItem.balance -= monthlyMinimumPayment;
            }
        }

        function makePriorityDebtPayment(paymentAmount, debtList) {
            let currentDebtIndex = debtList.length - 1;
            if (!debtList.length) {
                return false
            };

            let prioritizedDebtItem = debtList[currentDebtIndex];

            if (prioritizedDebtItem.balance > paymentAmount) {
                prioritizedDebtItem.balance -= paymentAmount;
            } else {
                let spilloverCash = paymentAmount - prioritizedDebtItem.balance;
                debtList.pop();
                makePriorityDebtPayment(spilloverCash, debtList);
            }
        }

        function getSnowballResults(debtList, debtBudget) {
            let results = {
                monthsToDebtFree: 0,
                totalInterestPaid: 0
            };
            let remainingTotalBalance = 1;

            while (debtList.length) {
                let totalMonthlyInterest = getTotalMonthlyInterest(debtList);
                let totalMonthlyPrinciple = getTotalMonthlyPrinciple(debtList);
                let priorityPaymentAmount = debtBudget - (totalMonthlyPrinciple + totalMonthlyInterest);

                results.monthsToDebtFree++;
                results.totalInterestPaid += totalMonthlyInterest;
                makeMinimumPrinciplePayments(debtList);
                makePriorityDebtPayment(priorityPaymentAmount, debtList);
                // remainingTotalBalance = getRemainingTotalBalance(debtList);
            }

            return results;
        }

        function populateDebtArray() {
            debts = [];

            $(".debts-list li").each(function () {
                let newDebt = {};

                newDebt.name = $(this).find("[data-debt-name]").val();
                newDebt.balance = $(this).find("[data-current-balance]").val();
                newDebt.interestRate = Number.parseFloat($(this).find("[data-interest-rate]").val() / 100).toFixed(4);
                newDebt.principleRate = Number.parseFloat(($(this).find("[data-min-payment]").val() - ((newDebt.balance * newDebt.interestRate) / 12)) / newDebt.balance).toFixed(4);

                debts.push(newDebt);
            });
        }

        function displaySnowballResults(balanceResults, interestResults) {
            $("[data-balance-years]").text(Math.floor(balanceResults.monthsToDebtFree / 12));
            $("[data-balance-months]").text(balanceResults.monthsToDebtFree % 12);
            $("[data-balance-cost]").text(Math.round(balanceResults.totalInterestPaid));
            $("[data-interest-years]").text(Math.floor(interestResults.monthsToDebtFree / 12));
            $("[data-interest-months]").text(interestResults.monthsToDebtFree % 12);
            $("[data-interest-cost]").text(Math.round(interestResults.totalInterestPaid));
            $("[data-results-card]").fadeIn();
        }

        function runSnowball() {
            populateDebtArray();

            let debtsByBalance = getDebtsByBalance();
            let debtsByInterestRate = getDebtsByInterestRate();
            let monthlyDebtBudget = $("[data-debt-budget]").val();

            if (!debtsByBalance.length || !debtsByInterestRate.length || !monthlyDebtBudget) {
                return false
            };

            let balanceResults = getSnowballResults(debtsByBalance, monthlyDebtBudget);
            let interestResults = getSnowballResults(debtsByInterestRate, monthlyDebtBudget);

            displaySnowballResults(balanceResults, interestResults);
        }
    </script>
</body>

</html>